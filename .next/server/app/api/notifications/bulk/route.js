(()=>{var a={};a.id=381,a.ids=[381],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30381:(a,b,c)=>{"use strict";c.d(b,{lY:()=>g});var d=c(31165);let e={[d.I.TIMESHEET_SUBMITTED]:{type:d.I.TIMESHEET_SUBMITTED,title:"Timesheet Submitted",message:"A new timesheet has been submitted for your approval",priority:d.B.HIGH,emailSubject:"Timesheet Submitted - Action Required",emailBody:"A new timesheet has been submitted and requires your approval."},[d.I.TIMESHEET_APPROVED]:{type:d.I.TIMESHEET_APPROVED,title:"Timesheet Approved",message:"Your timesheet has been approved",priority:d.B.MEDIUM,emailSubject:"Timesheet Approved",emailBody:"Your timesheet has been approved by your manager."},[d.I.TIMESHEET_REJECTED]:{type:d.I.TIMESHEET_REJECTED,title:"Timesheet Rejected",message:"Your timesheet has been rejected",priority:d.B.HIGH,emailSubject:"Timesheet Rejected - Action Required",emailBody:"Your timesheet has been rejected. Please review and resubmit."},[d.I.EXPENSE_SUBMITTED]:{type:d.I.EXPENSE_SUBMITTED,title:"Expense Submitted",message:"A new expense has been submitted for your approval",priority:d.B.HIGH,emailSubject:"Expense Submitted - Action Required",emailBody:"A new expense has been submitted and requires your approval."},[d.I.EXPENSE_APPROVED]:{type:d.I.EXPENSE_APPROVED,title:"Expense Approved",message:"Your expense has been approved",priority:d.B.MEDIUM,emailSubject:"Expense Approved",emailBody:"Your expense has been approved by your manager."},[d.I.EXPENSE_REJECTED]:{type:d.I.EXPENSE_REJECTED,title:"Expense Rejected",message:"Your expense has been rejected",priority:d.B.HIGH,emailSubject:"Expense Rejected - Action Required",emailBody:"Your expense has been rejected. Please review and resubmit."},[d.I.EXPENSES_PENDING_REMINDER]:{type:d.I.EXPENSES_PENDING_REMINDER,title:"Expenses Pending",message:"You have pending expenses that need to be submitted",priority:d.B.MEDIUM,emailSubject:"Expenses Pending - Reminder",emailBody:"You have pending expenses that need to be submitted for approval."},[d.I.TIMESHEET_OVERDUE]:{type:d.I.TIMESHEET_OVERDUE,title:"Timesheet Overdue",message:"Your timesheet is overdue and needs immediate attention",priority:d.B.CRITICAL,emailSubject:"Timesheet Overdue - Urgent Action Required",emailBody:"Your timesheet is overdue and requires immediate submission."},[d.I.MANAGER_PENDING_REMINDER]:{type:d.I.MANAGER_PENDING_REMINDER,title:"Pending Approvals",message:"You have pending items that require your approval",priority:d.B.HIGH,emailSubject:"Pending Approvals - Action Required",emailBody:"You have pending timesheets and expenses that require your approval."},[d.I.PERIOD_COMPLETE]:{type:d.I.PERIOD_COMPLETE,title:"Period Complete",message:"Your timesheet and expenses for this period have been approved",priority:d.B.MEDIUM,emailSubject:"Period Complete - Congratulations!",emailBody:"Your timesheet and expenses for this period have been approved."},[d.I.NEW_EMPLOYEE_ADDED]:{type:d.I.NEW_EMPLOYEE_ADDED,title:"New Employee Added",message:"A new employee has been added to your team",priority:d.B.INFO,emailSubject:"New Team Member Added",emailBody:"A new employee has been added to your team."},[d.I.ADMIN_APPROVAL_ACTIVITY]:{type:d.I.ADMIN_APPROVAL_ACTIVITY,title:"Approval Activity",message:"New approval activity has occurred in the system",priority:d.B.INFO,emailSubject:"System Approval Activity",emailBody:"New approval activity has occurred in the system."},[d.I.EMAIL_NOTIFICATION]:{type:d.I.EMAIL_NOTIFICATION,title:"Email Notification",message:"You have received an email notification",priority:d.B.LOW,emailSubject:"Email Notification",emailBody:"You have received an email notification."},[d.I.DEADLINE_REMINDER]:{type:d.I.DEADLINE_REMINDER,title:"Deadline Reminder",message:"A deadline is approaching",priority:d.B.MEDIUM,emailSubject:"Deadline Reminder",emailBody:"A deadline is approaching and requires your attention."},[d.I.PAYROLL_CUTOFF]:{type:d.I.PAYROLL_CUTOFF,title:"Payroll Cutoff",message:"Payroll cutoff is approaching",priority:d.B.HIGH,emailSubject:"Payroll Cutoff Reminder",emailBody:"Payroll cutoff is approaching. Please ensure all timesheets and expenses are submitted."},[d.I.OVERTIME_ALERT]:{type:d.I.OVERTIME_ALERT,title:"Overtime Alert",message:"Overtime hours detected in your timesheet",priority:d.B.MEDIUM,emailSubject:"Overtime Hours Detected",emailBody:"Overtime hours have been detected in your timesheet."},[d.I.LONG_SHIFT_ALERT]:{type:d.I.LONG_SHIFT_ALERT,title:"Long Shift Alert",message:"Unusually long shift detected",priority:d.B.MEDIUM,emailSubject:"Long Shift Detected",emailBody:"An unusually long shift has been detected in your timesheet."},[d.I.TRAINING_REMINDER]:{type:d.I.TRAINING_REMINDER,title:"Training Reminder",message:"Training session reminder",priority:d.B.LOW,emailSubject:"Training Session Reminder",emailBody:"This is a reminder about your upcoming training session."},[d.I.PERFORMANCE_REVIEW]:{type:d.I.PERFORMANCE_REVIEW,title:"Performance Review",message:"Performance review scheduled",priority:d.B.MEDIUM,emailSubject:"Performance Review Scheduled",emailBody:"Your performance review has been scheduled."},[d.I.WORK_ANNIVERSARY]:{type:d.I.WORK_ANNIVERSARY,title:"Work Anniversary",message:"Congratulations on your work anniversary!",priority:d.B.INFO,emailSubject:"Work Anniversary - Congratulations!",emailBody:"Congratulations on your work anniversary!"},[d.I.SYSTEM_INTEGRATION]:{type:d.I.SYSTEM_INTEGRATION,title:"System Integration",message:"System integration update",priority:d.B.INFO,emailSubject:"System Integration Update",emailBody:"System integration has been updated."}};class f{static getInstance(){return f.instance||(f.instance=new f),f.instance}createNotification(a,b,c,d,f){let g=e[a],h={id:`notif_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:a,title:g.title,message:g.message,priority:g.priority,userId:b,relatedId:c,relatedType:d,isRead:!1,isEmailSent:!1,createdAt:new Date,metadata:f};return this.notifications.push(h),this.notifyListeners(),this.persistNotifications(),this.sendEmailNotification(h),h}getUserNotifications(a){return this.notifications.filter(b=>b.userId===a).sort((a,b)=>new Date(b.createdAt).getTime()-new Date(a.createdAt).getTime())}getUnreadNotifications(a){return this.getUserNotifications(a).filter(a=>!a.isRead)}markAsRead(a){let b=this.notifications.find(b=>b.id===a);b&&(b.isRead=!0,b.readAt=new Date,this.notifyListeners(),this.persistNotifications())}markAllAsRead(a){this.notifications.filter(b=>b.userId===a&&!b.isRead).forEach(a=>{a.isRead=!0,a.readAt=new Date}),this.notifyListeners(),this.persistNotifications()}deleteNotification(a){this.notifications=this.notifications.filter(b=>b.id!==a),this.notifyListeners(),this.persistNotifications()}getNotificationStats(a){let b=this.getUserNotifications(a),c=b.filter(a=>!a.isRead);return{total:b.length,unread:c.length,critical:c.filter(a=>a.priority===d.B.CRITICAL).length,high:c.filter(a=>a.priority===d.B.HIGH).length,medium:c.filter(a=>a.priority===d.B.MEDIUM).length,low:c.filter(a=>a.priority===d.B.LOW).length,byType:Object.values(d.I).reduce((a,b)=>(a[b]=c.filter(a=>a.type===b).length,a),{})}}async crossCheckTimesheetExpenses(a,b){return{employeeId:a,period:b,timesheetStatus:"approved",expensesStatus:"pending",hasPendingItems:!0,periodComplete:!1}}createCrossCheckNotifications(a,b){this.crossCheckTimesheetExpenses(a,b).then(c=>{c.hasPendingItems&&this.createNotification(d.I.EXPENSES_PENDING_REMINDER,a,void 0,"expense",{period:b,timesheetStatus:c.timesheetStatus}),c.periodComplete&&this.createNotification(d.I.PERIOD_COMPLETE,a,void 0,"timesheet",{period:b})})}async sendEmailNotification(a){try{let b=a.metadata?.userEmail||`${a.userId}@westendworkforce.com`;try{(await fetch("/api/notifications/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:b,notification:a,customData:a.metadata})})).ok?a.isEmailSent=!0:console.warn(`Failed to send email notification to ${b}`)}catch(a){console.error("Failed to send email notification via API:",a)}}catch(a){console.error("Failed to send email notification:",a)}}subscribe(a){return this.listeners.add(a),()=>this.listeners.delete(a)}notifyListeners(){this.listeners.forEach(a=>a([...this.notifications]))}persistNotifications(){try{localStorage.setItem("notifications",JSON.stringify(this.notifications))}catch(a){console.error("Failed to persist notifications:",a)}}loadNotifications(){try{let a=localStorage.getItem("notifications");a&&(this.notifications=JSON.parse(a).map(a=>({...a,createdAt:new Date(a.createdAt),readAt:a.readAt?new Date(a.readAt):void 0,expiresAt:a.expiresAt?new Date(a.expiresAt):void 0})))}catch(a){console.error("Failed to load notifications:",a)}}async initialize(){this.loadNotifications()}constructor(){this.notifications=[],this.listeners=new Set}}let g=f.getInstance()},31165:(a,b,c)=>{"use strict";c.d(b,{B:()=>e,I:()=>d});let d={TIMESHEET_SUBMITTED:"timesheet_submitted",TIMESHEET_APPROVED:"timesheet_approved",TIMESHEET_REJECTED:"timesheet_rejected",EXPENSE_SUBMITTED:"expense_submitted",EXPENSE_APPROVED:"expense_approved",EXPENSE_REJECTED:"expense_rejected",EXPENSES_PENDING_REMINDER:"expenses_pending_reminder",TIMESHEET_OVERDUE:"timesheet_overdue",MANAGER_PENDING_REMINDER:"manager_pending_reminder",PERIOD_COMPLETE:"period_complete",NEW_EMPLOYEE_ADDED:"new_employee_added",ADMIN_APPROVAL_ACTIVITY:"admin_approval_activity",EMAIL_NOTIFICATION:"email_notification",DEADLINE_REMINDER:"deadline_reminder",PAYROLL_CUTOFF:"payroll_cutoff",OVERTIME_ALERT:"overtime_alert",LONG_SHIFT_ALERT:"long_shift_alert",TRAINING_REMINDER:"training_reminder",PERFORMANCE_REVIEW:"performance_review",WORK_ANNIVERSARY:"work_anniversary",SYSTEM_INTEGRATION:"system_integration"},e={CRITICAL:"critical",HIGH:"high",MEDIUM:"medium",LOW:"low",INFO:"info"}},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61904:()=>{throw Error("Module build failed (from ./node_modules/next/dist/build/webpack/loaders/next-swc-loader.js):\nError:   \x1b[31mx\x1b[0m Expected ';', '}' or <eof>\n     ,-[\x1b[36;1;4m/Users/virtual24/Projects/west-end-workforce/src/lib/emailService.ts\x1b[0m:104:1]\n \x1b[2m101\x1b[0m |           \n \x1b[2m102\x1b[0m |           // On client side, just log the email\n \x1b[2m103\x1b[0m |           if (typeof window !== 'undefined') {\n \x1b[2m104\x1b[0m | \x1b[35;1m,\x1b[0m\x1b[35;1m-\x1b[0m\x1b[35;1m>\x1b[0m           to: toEmail,\n \x1b[2m105\x1b[0m | \x1b[35;1m|\x1b[0m\x1b[35;1m-\x1b[0m\x1b[35;1m>\x1b[0m           subject: template.subject,\n     : \x1b[35;1m`\x1b[0m\x1b[35;1m---\x1b[0m\x1b[33;1m                 ^\x1b[0m\n     : \x1b[35;1m`\x1b[0m\x1b[35;1m---\x1b[0m\x1b[35;1m-\x1b[0m \x1b[35;1mThis is the expression part of an expression statement\x1b[0m\n \x1b[2m106\x1b[0m |               from: `${this.config.fromName} <${this.config.fromEmail}>`\n \x1b[2m107\x1b[0m |             });\n \x1b[2m108\x1b[0m |             return true;\n     `----\n\n\nCaused by:\n    Syntax Error")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},96477:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>F,patchFetch:()=>E,routeModule:()=>A,serverHooks:()=>D,workAsyncStorage:()=>B,workUnitAsyncStorage:()=>C});var d={};c.r(d),c.d(d,{GET:()=>z,POST:()=>y});var e=c(96559),f=c(48088),g=c(37719),h=c(26191),i=c(81289),j=c(261),k=c(92603),l=c(39893),m=c(14823),n=c(47220),o=c(66946),p=c(47912),q=c(99786),r=c(46143),s=c(86439),t=c(43365),u=c(32190),v=c(30381),w=c(61904),x=c(31165);async function y(a){try{let{type:b,userIds:c,title:d,message:e,priority:f=x.B.MEDIUM,sendEmail:g=!0,metadata:h={}}=await a.json();if(!b||!c||!Array.isArray(c)||0===c.length)return u.NextResponse.json({error:"Type and userIds array are required"},{status:400});if(!d||!e)return u.NextResponse.json({error:"Title and message are required"},{status:400});if(!Object.values(x.I).includes(b))return u.NextResponse.json({error:"Invalid notification type"},{status:400});if(!Object.values(x.B).includes(f))return u.NextResponse.json({error:"Invalid priority level"},{status:400});let i={successful:[],failed:[],notifications:[]};for(let a of c)try{let d=v.lY.createNotification(b,a,void 0,"system",{...h,bulkNotification:!0,totalRecipients:c.length});i.notifications.push(d),i.successful.push(a)}catch(b){console.error(`Failed to create notification for user ${a}:`,b),i.failed.push(a)}if(g&&i.successful.length>0)try{let a=i.successful.map(a=>`${a}@westendworkforce.com`),g={id:"bulk-notification",type:b,title:d,message:e,priority:f,userId:"bulk",isRead:!1,isEmailSent:!1,createdAt:new Date},j=await w.emailService.sendBulkEmailNotifications(a,g,{...h,bulkNotification:!0,totalRecipients:c.length});i.successful=j.success,i.failed=[...i.failed,...j.failed]}catch(a){console.error("Failed to send bulk emails:",a)}return u.NextResponse.json({success:!0,message:`Bulk notification created for ${i.successful.length} users`,results:i,summary:{total:c.length,successful:i.successful.length,failed:i.failed.length}})}catch(a){return console.error("Error sending bulk notifications:",a),u.NextResponse.json({error:"Failed to send bulk notifications"},{status:500})}}async function z(){try{return u.NextResponse.json({success:!0,stats:{totalBulkNotifications:0,totalRecipients:0,averageRecipientsPerNotification:0,mostCommonType:"system",lastBulkNotification:null},message:"Bulk notification statistics retrieved successfully"})}catch(a){return console.error("Error getting bulk notification statistics:",a),u.NextResponse.json({error:"Failed to get bulk notification statistics"},{status:500})}}let A=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/notifications/bulk/route",pathname:"/api/notifications/bulk",filename:"route",bundlePath:"app/api/notifications/bulk/route"},distDir:".next",projectDir:"",resolvedPagePath:"/Users/virtual24/Projects/west-end-workforce/src/app/api/notifications/bulk/route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:B,workUnitAsyncStorage:C,serverHooks:D}=A;function E(){return(0,g.patchFetch)({workAsyncStorage:B,workUnitAsyncStorage:C})}async function F(a,b,c){var d;let e="/api/notifications/bulk/route";"/index"===e&&(e="/");let g=await A.prepare(a,b,{srcPage:e,multiZoneDraftMode:"false"});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,resolvedPathname:D}=g,E=(0,j.normalizeAppPath)(e),F=!!(y.dynamicRoutes[E]||y.routes[D]);if(F&&!x){let a=!!y.routes[D],b=y.dynamicRoutes[E];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||A.isDev||x||(G="/index"===(G=D)?"/":G);let H=!0===A.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:y,renderOpts:{experimental:{dynamicIO:!!w.experimental.dynamicIO,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>A.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>A.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&B&&C&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await A.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})},z),b}},l=await A.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",B?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(L||b instanceof s.NoFallbackError||await A.onRequestError(a,b,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},96487:()=>{}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[4985,6055],()=>b(b.s=96477));module.exports=c})();